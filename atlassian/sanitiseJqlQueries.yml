apiVersion: backstage.io/v1alpha1
kind: API
metadata:
  name: Sanitize Jql Queries
  description: >-
    Sanitizes one or more JQL queries by converting readable details into IDs
    where a user doesn't have permission to view the entity.For example, if the
    query contains the clause *project = 'Secret project'*, and a user does not
    have browse permission for the project "Secret project", the sanitized query
    replaces the clause with *project = 12345"* (where 12345 is the ID of the
    project). If a user has the required permission, the clause is not
    sanitized. If the account ID is null, sanitizing is performed for an
    anonymous user.Note that sanitization doesn't make the queries
    GDPR-compliant, because it doesn't remove user identifiers (username or user
    key). If you need to make queries GDPR-compliant, use [Convert user
    identifiers to account IDs in JQL
    queries](https://developer.atlassian.com/cloud/jira/platform/rest/v3/api-group-jql/#api-rest-api-3-jql-sanitize-post).Before
    sanitization each JQL query is parsed. The queries are returned in the same
    order that they were passed.**[Permissions](#permissions) required:**
    *Administer Jira* [global
    permission](https://confluence.atlassian.com/x/x4dKLg).
  tags: []
  links:
    - title: Link
      icon: code
      url: https://example.com
spec:
  type: openapi
  lifecycle: experimental
  owner: team-c
  definition: |
    openapi: 3.1.0
    info:
      title: Sanitize Jql Queries
      description: >-
        Sanitizes one or more JQL queries by converting readable details into IDs
        where a user doesn't have permission to view the entity.For example, if the
        query contains the clause *project = 'Secret project'*, and a user does not
        have browse permission for the project "Secret project", the sanitized query
        replaces the clause with *project = 12345"* (where 12345 is the ID of the
        project). If a user has the required permission, the clause is not
        sanitized. If the account ID is null, sanitizing is performed for an
        anonymous user.Note that sanitization doesn't make the queries
        GDPR-compliant, because it doesn't remove user identifiers (username or user
        key). If you need to make queries GDPR-compliant, use [Convert user
        identifiers to account IDs in JQL
        queries](https://developer.atlassian.com/cloud/jira/platform/rest/v3/api-group-jql/#api-rest-api-3-jql-sanitize-post).Before
        sanitization each JQL query is parsed. The queries are returned in the same
        order that they were passed.**[Permissions](#permissions) required:**
        *Administer Jira* [global
        permission](https://confluence.atlassian.com/x/x4dKLg).
    paths:
      /rest/api/3/jql/sanitize:
        post:
          summary: Sanitize Jql Queries
          description: >-
            Sanitizes one or more JQL queries by converting readable details into
            IDs where a user doesn't have permission to view the entity.For example,
            if the query contains the clause *project = 'Secret project'*, and a
            user does not have browse permission for the project "Secret project",
            the sanitized query replaces the clause with *project = 12345"* (where
            12345 is the ID of the project). If a user has the required permission,
            the clause is not sanitized. If the account ID is null, sanitizing is
            performed for an anonymous user.Note that sanitization doesn't make the
            queries GDPR-compliant, because it doesn't remove user identifiers
            (username or user key). If you need to make queries GDPR-compliant, use
            [Convert user identifiers to account IDs in JQL
            queries](https://developer.atlassian.com/cloud/jira/platform/rest/v3/api-group-jql/#api-rest-api-3-jql-sanitize-post).Before
            sanitization each JQL query is parsed. The queries are returned in the
            same order that they were passed.**[Permissions](#permissions)
            required:** *Administer Jira* [global
            permission](https://confluence.atlassian.com/x/x4dKLg).
          operationId: sanitiseJqlQueries
          requestBody:
            required: true
            content:
              application/json:
                example:
                  queries:
                    - query: project = 'Sample project'
                    - accountId: 5b10ac8d82e05b22cc7d4ef5
                      query: project = 'Sample project'
                    - accountId: cda2aa1395ac195d951b3387
                      query: project = 'Sample project'
                    - accountId: 5b10ac8d82e05b22cc7d4ef5
                      query: invalid query
                schema:
                  $ref: '#/components/schemas/JqlQueriesToSanitize'
          responses:
            '403':
              content:
                application/json:
                  example: >-
                    {"errorMessages":["You are not authorized to perform this
                    action. Administrator privileges are required."],"errors":{}}
                  schema:
                    $ref: '#/components/schemas/ErrorCollection'
              description: Returned if the user does not have the necessary permission.
