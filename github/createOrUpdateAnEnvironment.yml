apiVersion: backstage.io/v1alpha1
kind: API
metadata:
  name: Create Or Update An Environment
  description: >-
    Create or update an environment with protection rules, such as required
    reviewers. For more information about environment protection rules, see
    "[Environments](/actions/reference/environments#environment-protection-rules)."**Note:**
    To create or update name patterns that branches must match in order to
    deploy to this environment, see "[Deployment branch
    policies](/rest/deployments/branch-policies)."**Note:** To create or update
    secrets for an environment, see "[GitHub Actions
    secrets](/rest/actions/secrets)."OAuth app tokens and personal access tokens
    (classic) need the `repo` scope to use this endpoint.
  tags: []
  links:
    - title: Link
      icon: code
      url: https://example.com
spec:
  type: openapi
  lifecycle: experimental
  owner: team-c
  definition: |
    openapi: 3.1.0
    info:
      title: Create Or Update An Environment
      description: >-
        Create or update an environment with protection rules, such as required
        reviewers. For more information about environment protection rules, see
        "[Environments](/actions/reference/environments#environment-protection-rules)."**Note:**
        To create or update name patterns that branches must match in order to
        deploy to this environment, see "[Deployment branch
        policies](/rest/deployments/branch-policies)."**Note:** To create or update
        secrets for an environment, see "[GitHub Actions
        secrets](/rest/actions/secrets)."OAuth app tokens and personal access tokens
        (classic) need the `repo` scope to use this endpoint.
    paths:
      /repos/{owner}/{repo}/environments/{environment_name}:
        put:
          summary: Create Or Update An Environment
          description: >-
            Create or update an environment with protection rules, such as required
            reviewers. For more information about environment protection rules, see
            "[Environments](/actions/reference/environments#environment-protection-rules)."**Note:**
            To create or update name patterns that branches must match in order to
            deploy to this environment, see "[Deployment branch
            policies](/rest/deployments/branch-policies)."**Note:** To create or
            update secrets for an environment, see "[GitHub Actions
            secrets](/rest/actions/secrets)."OAuth app tokens and personal access
            tokens (classic) need the `repo` scope to use this endpoint.
          operationId: createOrUpdateAnEnvironment
          requestBody:
            content:
              application/json:
                schema:
                  type: object
                  nullable: true
                  properties:
                    wait_timer:
                      $ref: '#/components/schemas/wait-timer'
                    reviewers:
                      type: array
                      nullable: true
                      description: >-
                        The people or teams that may review jobs that reference the
                        environment. You can list up to six users or teams as
                        reviewers. The reviewers must have at least read access to
                        the repository. Only one of the required reviewers needs to
                        approve the job for it to proceed.
                      items:
                        type: object
                        properties:
                          type:
                            $ref: '#/components/schemas/deployment-reviewer-type'
                          id:
                            type: integer
                            description: >-
                              The id of the user or team who can review the
                              deployment
                            example: 4532992
                    deployment_branch_policy:
                      $ref: '#/components/schemas/deployment-branch-policy-settings'
                  additionalProperties: false
                examples:
                  default:
                    value:
                      wait_timer: 30
                      reviewers:
                        - type: User
                          id: 1
                        - type: Team
                          id: 1
                      deployment_branch_policy:
                        protected_branches: false
                        custom_branch_policies: true
          responses:
            '422':
              description: >-
                Validation error when the environment name is invalid or when
                `protected_branches` and `custom_branch_policies` in
                `deployment_branch_policy` are set to the same value
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/basic-error'
