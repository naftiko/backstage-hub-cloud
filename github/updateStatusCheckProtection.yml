apiVersion: backstage.io/v1alpha1
kind: API
metadata:
  name: Update Status Check Protection
  description: >-
    Protected branches are available in public repositories with GitHub Free and
    GitHub Free for organizations, and in public and private repositories with
    GitHub Pro, GitHub Team, GitHub Enterprise Cloud, and GitHub Enterprise
    Server. For more information, see [GitHub's
    products](https://docs.github.com/enterprise-server@3.9/github/getting-started-with-github/githubs-products)
    in the GitHub Help documentation.Updating required status checks requires
    admin or owner permissions to the repository and branch protection to be
    enabled.
  tags: []
  links:
    - title: Link
      icon: code
      url: https://example.com
spec:
  type: openapi
  lifecycle: experimental
  owner: team-c
  definition: |
    openapi: 3.1.0
    info:
      title: Update Status Check Protection
      description: >-
        Protected branches are available in public repositories with GitHub Free and
        GitHub Free for organizations, and in public and private repositories with
        GitHub Pro, GitHub Team, GitHub Enterprise Cloud, and GitHub Enterprise
        Server. For more information, see [GitHub's
        products](https://docs.github.com/enterprise-server@3.9/github/getting-started-with-github/githubs-products)
        in the GitHub Help documentation.Updating required status checks requires
        admin or owner permissions to the repository and branch protection to be
        enabled.
    paths:
      /repos/{owner}/{repo}/branches/{branch}/protection/required_status_checks:
        patch:
          summary: Update Status Check Protection
          description: >-
            Protected branches are available in public repositories with GitHub Free
            and GitHub Free for organizations, and in public and private
            repositories with GitHub Pro, GitHub Team, GitHub Enterprise Cloud, and
            GitHub Enterprise Server. For more information, see [GitHub's
            products](https://docs.github.com/enterprise-server@3.9/github/getting-started-with-github/githubs-products)
            in the GitHub Help documentation.Updating required status checks
            requires admin or owner permissions to the repository and branch
            protection to be enabled.
          operationId: updateStatusCheckProtection
          requestBody:
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    strict:
                      type: boolean
                      description: Require branches to be up to date before merging.
                    contexts:
                      type: array
                      deprecated: true
                      description: >
                        **Deprecated**: The list of status checks to require in
                        order to merge into this branch. If any of these checks have
                        recently been set by a particular GitHub App, they will be
                        required to come from that app in future for the branch to
                        merge. Use `checks` instead of `contexts` for more
                        fine-grained control.
                      items:
                        type: string
                    checks:
                      type: array
                      description: >-
                        The list of status checks to require in order to merge into
                        this branch.
                      items:
                        type: object
                        required:
                          - context
                        properties:
                          context:
                            type: string
                            description: The name of the required check
                          app_id:
                            type: integer
                            description: >-
                              The ID of the GitHub App that must provide this check.
                              Omit this field to automatically select the GitHub App
                              that has recently provided this check, or any app if
                              it was not set by a GitHub App. Pass -1 to explicitly
                              allow any app to set the status.
                examples:
                  default:
                    value:
                      strict: true
                      contexts:
                        - continuous-integration/travis-ci
          responses:
            '422':
              $ref: '#/components/responses/validation_failed'
