apiVersion: backstage.io/v1alpha1
kind: API
metadata:
  name: Authenticate A Domain
  description: >-
    **This endpoint allows you to authenticate a domain.**If you are
    authenticating a domain for a subuser, you have two options:1. Use the
    "username" parameter. This allows you to authenticate a domain on behalf of
    your subuser. This means the subuser is able to see and modify the
    authenticated domain.2. Use the Association workflow (see Associate Domain
    section). This allows you to authenticate a domain created by the parent to
    a subuser. This means the subuser will default to the assigned domain, but
    will not be able to see or modify that authenticated domain. However, if the
    subuser authenticates their own domain it will overwrite the assigned
    domain.
  tags: []
  links:
    - title: Link
      icon: code
      url: https://example.com
spec:
  type: openapi
  lifecycle: experimental
  owner: team-c
  definition: |
    openapi: 3.1.0
    info:
      title: Authenticate A Domain
      description: >-
        **This endpoint allows you to authenticate a domain.**If you are
        authenticating a domain for a subuser, you have two options:1. Use the
        "username" parameter. This allows you to authenticate a domain on behalf of
        your subuser. This means the subuser is able to see and modify the
        authenticated domain.2. Use the Association workflow (see Associate Domain
        section). This allows you to authenticate a domain created by the parent to
        a subuser. This means the subuser will default to the assigned domain, but
        will not be able to see or modify that authenticated domain. However, if the
        subuser authenticates their own domain it will overwrite the assigned
        domain.
    paths:
      /v3/whitelabel/domains:
        post:
          summary: Authenticate A Domain
          description: >-
            **This endpoint allows you to authenticate a domain.**If you are
            authenticating a domain for a subuser, you have two options:1. Use the
            "username" parameter. This allows you to authenticate a domain on behalf
            of your subuser. This means the subuser is able to see and modify the
            authenticated domain.2. Use the Association workflow (see Associate
            Domain section). This allows you to authenticate a domain created by the
            parent to a subuser. This means the subuser will default to the assigned
            domain, but will not be able to see or modify that authenticated domain.
            However, if the subuser authenticates their own domain it will overwrite
            the assigned domain.
          operationId: authenticateDomain
          requestBody:
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    domain:
                      type: string
                      description: Domain being authenticated.
                    subdomain:
                      type: string
                      description: >-
                        The subdomain or custom return-path to use for this
                        authenticated domain.
                    username:
                      type: string
                      description: The username associated with this domain.
                    ips:
                      type: array
                      description: >-
                        The IP addresses that will be included in the custom SPF
                        record for this authenticated domain.
                      items:
                        type: string
                    custom_spf:
                      type: boolean
                      description: >-
                        Specify whether to use a custom SPF or allow SendGrid to
                        manage your SPF. This option is only available to
                        authenticated domains set up for manual security.
                    default:
                      type: boolean
                      description: >-
                        Whether to use this authenticated domain as the fallback if
                        no authenticated domains match the sender's domain.
                    automatic_security:
                      type: boolean
                      description: >-
                        Whether to allow SendGrid to manage your SPF records, DKIM
                        keys, and DKIM key rotation.
                    custom_dkim_selector:
                      type: string
                      description: >-
                        Add a custom DKIM selector. Accepts three letters or
                        numbers.
                    region:
                      type: string
                      description: >-
                        The region of the domain. Allowed values are `global` and
                        `eu`. The default value is `global`.
                  required:
                    - domain
                  example:
                    domain: example.com
                    subdomain: news
                    username: john@example.com
                    ips:
                      - 192.168.1.1
                      - 192.168.1.2
                    custom_spf: true
                    default: true
                    automatic_security: false
                    custom_dkim_selector: string
                    region: global
          responses:
            '201':
              description: ''
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/AuthenticatedDomain'
                  examples:
                    response:
                      value:
                        id: 302183
                        user_id: 1446226
                        subdomain: example
                        domain: example.com
                        username: mbernier
                        ips: []
                        custom_spf: false
                        default: true
                        legacy: false
                        automatic_security: true
                        valid: false
                        dns:
                          mail_cname:
                            valid: false
                            type: cname
                            host: example.example.com
                            data: u1446226.wl.sendgrid.net
                          dkim1:
                            valid: false
                            type: cname
                            host: s1._domainkey.example.com
                            data: s1.domainkey.u1446226.wl.sendgrid.net
                          dkim2:
                            valid: false
                            type: cname
                            host: s2._domainkey.example.com
                            data: s2.domainkey.u1446226.wl.sendgrid.net
